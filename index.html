<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento de Atividades de Obra</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #conteudo {
            display: flex;
            justify-content: space-around;
        }

        .atividade {
            margin-bottom: 20px;
            width: 300px;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .data-group {
            margin-bottom: 10px;
        }

        #grafico, #curvaS, #baseline {
            width: 400px;
            height: 300px;
            margin: 20px;
        }

        svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <h1>Acompanhamento de Atividades de Obra</h1>
    <div id="conteudo">
        <div class="atividade" data-atividade="1">
            <h2>Atividade 1</h2>
            <div class="data-group">
                <label>Baseline Início: <input type="date" name="baselineInicio1" value="2024-07-01" disabled></label>
                <label>Baseline Término: <input type="date" name="baselineTermino1" value="2024-07-10" disabled></label>
            </div>
            <div class="data-group">
                <label>Atual Início: <input type="date" name="atualInicio1" value="2024-07-02"></label>
                <label>Atual Término: <input type="date" name="atualTermino1" value="2024-07-12"></label>
            </div>
        </div>
        <div class="atividade" data-atividade="2">
            <h2>Atividade 2</h2>
            <div class="data-group">
                <label>Baseline Início: <input type="date" name="baselineInicio2" value="2024-07-05" disabled></label>
                <label>Baseline Término: <input type="date" name="baselineTermino2" value="2024-07-15" disabled></label>
            </div>
            <div class="data-group">
                <label>Atual Início: <input type="date" name="atualInicio2" value="2024-07-06"></label>
                <label>Atual Término: <input type="date" name="atualTermino2" value="2024-07-16"></label>
            </div>
        </div>
    </div>
    <div id="grafico"></div>
    <div id="curvas">
        <div id="curvaS"></div>
        <div id="curvaBaseline"></div>
    </div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const atividades = document.querySelectorAll('.atividade');
            const atualInputs = document.querySelectorAll('input[name^="atual"]');
            const baselineData = [];

            // Captura as datas de baseline para desenhar o gráfico de linha
            atividades.forEach(atividade => {
                const baselineInicio = new Date(atividade.querySelector(`input[name^="baselineInicio"]`).value);
                const baselineTermino = new Date(atividade.querySelector(`input[name^="baselineTermino"]`).value);
                baselineData.push({ inicio: baselineInicio, termino: baselineTermino });
            });

            atualInputs.forEach(input => {
                input.addEventListener('change', function() {
                    updateCurvas();
                });
            });

            function updateCurvas() {
                const atualData = Array.from(atividades).map(atividade => {
                    const inicio = new Date(atividade.querySelector(`input[name^="atualInicio"]`).value);
                    const termino = new Date(atividade.querySelector(`input[name^="atualTermino"]`).value);
                    return { inicio, termino };
                });

                const svgCurvaS = d3.select("#curvaS").html("").append("svg")
                    .attr("width", 400)
                    .attr("height", 300);

                const svgCurvaBaseline = d3.select("#curvaBaseline").html("").append("svg")
                    .attr("width", 400)
                    .attr("height", 300);

                drawCurva(svgCurvaS, atualData, "Curva S", "red");
                drawCurva(svgCurvaBaseline, baselineData, "Baseline", "blue");
            }

            function drawCurva(svg, data, label, color) {
                const x = d3.scaleTime().range([50, 350]);
                const y = d3.scaleLinear().range([250, 50]);

                const line = d3.line()
                    .x(d => x(d.inicio))
                    .y((d, i) => y((i + 1) / data.length * 100));

                x.domain(d3.extent(data.flatMap(d => [d.inicio, d.termino])));
                y.domain([0, 100]);

                svg.append("path")
                    .data([data])
                    .attr("class", "line")
                    .attr("d", line)
                    .attr("stroke", color)
                    .attr("stroke-width", 2)
                    .attr("fill", "none");

                svg.selectAll("dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("r", 5)
                    .attr("cx", d => x(d.inicio))
                    .attr("cy", (d, i) => y((i + 1) / data.length * 100))
                    .attr("fill", color)
                    .append("title")
                    .text(d => `Início: ${d.inicio.toLocaleDateString()}, Término: ${d.termino.toLocaleDateString()}`);

                svg.append("text")
                    .attr("x", 200)
                    .attr("y", 280)
                    .style("text-anchor", "middle")
                    .text(label);
            }

            updateCurvas();
        });
    </script>
</body>
</html>
