<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento de Atividades de Obra</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c2c2c;
            color: #fff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #555;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #444;
        }

        .tarefa {
            font-weight: bold;
            text-align: left;
            padding-left: 20px;
        }

        .tarefa[data-subtarefa="true"] {
            padding-left: 40px;
        }

        .tarefa[data-subsubtarefa="true"] {
            padding-left: 60px;
        }

        .editavel {
            position: relative;
        }

        .editavel input {
            width: 100%;
            box-sizing: border-box;
            background-color: #333;
            color: #fff;
            border: none;
            text-align: center;
        }

        .editavel input[type="date"] {
            -webkit-appearance: none;
        }

        .editavel input[type="number"] {
            -moz-appearance: textfield;
        }

        .progresso {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .progresso::before {
            content: '●';
            margin-right: 8px;
            font-size: 1.5em;
        }

        .progresso[data-progresso="0"]::before {
            color: red;
        }

        .progresso[data-progresso="100"]::before {
            color: green;
        }

        .progresso[data-progresso="partial"]::before {
            color: yellow;
        }

        .progresso input[type="number"] {
            display: none;
        }

        .s-curve-container {
            margin-top: 40px;
            text-align: center;
        }

        .s-curve-chart {
            display: inline-block;
            width: 80%;
            height: 300px;
        }

        .s-curve-info {
            color: #ccc;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <h1>Acompanhamento de Atividades de Obra</h1>

    <table>
        <thead>
            <tr>
                <th rowspan="2">Tarefas</th>
                <th rowspan="2">ID</th>
                <th colspan="5">Previsto</th>
                <th colspan="3">Realizado</th>
            </tr>
            <tr>
                <th>Peso</th>
                <th>Duração</th>
                <th>Início</th>
                <th>Término</th>
                <th>Progresso</th>
                <th>Progresso</th>
                <th>Início</th>
                <th>Término</th>
            </tr>
        </thead>
        <tbody>
            <!-- Exemplo de 10 atividades -->
            <tr>
                <td class="tarefa">OBRA</td>
                <td>1</td>
                <td>100%</td>
                <td>55 dias</td>
                <td>08 set 23</td>
                <td>01 nov 23</td>
                <td>58%</td>
                <td class="editavel">
                    <div class="progresso" data-progresso="partial" onclick="toggleEdit(this.nextElementSibling)">● 58%</div>
                    <input type="number" value="58" min="0" max="100" onchange="updateProgress(this)">
                </td>
                <td class="editavel"><input type="date" value="2023-09-08"></td>
                <td class="editavel"><input type="date"></td>
            </tr>
            <!-- Outras atividades omitidas por brevidade -->
        </tbody>
    </table>

    <!-- Curva S -->
    <div class="s-curve-container">
        <h2>Curva S - Execução do Cronograma</h2>
        <div class="s-curve-chart" id="s-curve-chart"></div>
        <div class="s-curve-info">
            Cumprir o prazo de entrega é fator fundamental para qualquer construção. Para entregar a obra dentro do prazo, é necessário ter acesso a uma série de informações. Dessa maneira, quanto maior for o detalhamento das atividades, mas fácil será a gestão do cronograma de obras.<br><br>
            Portanto, a Curva S se mostra mais um elemento fundamental para a execução adequada de um cronograma. Por meio deste instrumento, torna-se possível cruzar informações e dados que já foram concluídos na obra, além de saber o quanto foi gasto.<br><br>
            Desse modo, o balanceamento permite que o gestor de obra equilibre o calendário e os custos em uma previsibilidade operacional. É, portanto, um instrumento de gestão.<br><br>
            A Curva S da obra tem como finalidade comparar de forma técnica o que foi planejado com o que está sendo executado. Por sua ampla utilização, além de intuitividade, diversos profissionais e empresas da construção civil utilizam a Curva S como instrumento de gestão nos projetos da construção civil.<br><br>
            De forma resumida, a Curva S representa o percentual em um período de tempo determinado (dia, semana, quinzena ou mês). Além disso, destaca o percentual acumulado ao longo do tempo. Assim, essa ferramenta demonstra o volume desenvolvido no projeto.
        </div>
    </div>

    <script>
        function toggleEdit(input) {
            input.previousElementSibling.style.display = 'none';
            input.style.display = 'block';
            input.focus();
        }

        function updateProgress(input) {
            const value = input.value;
            const display = input.previousElementSibling;

            if (value == 0) {
                display.setAttribute('data-progresso', '0');
                display.textContent = '● 0%';
            } else if (value == 100) {
                display.setAttribute('data-progresso', '100');
                display.textContent = '● 100%';
            } else {
                display.setAttribute('data-progresso', 'partial');
                display.textContent = `● ${value}%`;
            }

            display.style.display = 'flex';
            input.style.display = 'none';
        }

        document.addEventListener("DOMContentLoaded", function() {
            const execucaoData = [
                { status: "Planejada", value: 100 },
                { status: "Iniciada", value: 0 },
                { status: "Finalizada", value: 0 }
            ];

            const sCurveData = [
                { day: 0, percent: 0 },
                { day: 20, percent: 10 },
                { day: 40, percent: 30 },
                { day: 60, percent: 60 },
                { day: 80, percent: 90 },
                { day: 100, percent: 100 }
            ];

            function createSCurve(data, containerID) {
                const container = d3.select(containerID);
                const margin = { top: 20, right: 30, bottom: 40, left: 40 };
                const width = parseInt(container.style("width")) - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                const svg = container.append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const x = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.day)])
                    .range([0, width]);

                const y = d3.scaleLinear()
                    .domain([0, 100])
                    .range([height, 0]);

                const line = d3.line()
                    .x(d => x(d.day))
                    .y(d => y(d.percent))
                    .curve(d3.curveStepAfter);

                svg.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line);

                svg.selectAll(".dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("cx", d => x(d.day))
                    .attr("cy", d => y(d.percent))
                    .attr("r", 5)
                    .on("mouseover", function(d) {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9);
                        tooltip.html(`Dia ${d.day}: ${d.percent}%`)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x));

                svg.append("g")
                    .call(d3.axisLeft(y));

                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);
            }

            createSCurve(sCurveData, "#s-curve-chart");
        });
    </script>
</body>
</html>
